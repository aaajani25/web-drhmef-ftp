var ptssBuildPress=ptssBuildPress||{};ptssBuildPress.events={};_.extend(ptssBuildPress.events,Backbone.Events);jQuery(document).ready(function($){new ptssBuildPress.frameView({el:'.js-ptss-frame',model:new ptssBuildPress.Frame(),});$('body').append($('<style id="ptss__skin-css" />'));new ptssBuildPress.cssView({el:'#ptss__skin-css',});new ptssBuildPress.pageLayoutView({el:'#ptss__layout',model:ptssBuildPress.PageLayout,});new ptssBuildPress.navPositionView({el:'#ptss__nav-position',model:new ptssBuildPress.NavPosition(),});new ptssBuildPress.colorPaletteView({el:'#ptss__color-skin',});new ptssBuildPress.bgImgsView({el:'#ptss__boxed-bg',});});(function(){var $=jQuery;ptssBuildPress.Frame=Backbone.Model.extend({defaults:{isVisible:false,},initialize:function(){var current=localStorage.getItem(ptssVars.siteId+'_isVisible');if(null===current){this.set('isVisible',true);setTimeout(_.bind(this.toggleVisibility,this),2000);}
else{this.set('isVisible','true'===current);}},toggleVisibility:function(){this.set('isVisible',!this.get('isVisible'));localStorage.setItem(ptssVars.siteId+'_isVisible',this.get('isVisible'));},});ptssBuildPress.frameView=Backbone.View.extend({events:{'click .js-ptss-toggle-btn':'toggleVisibility',},initialize:function(){this.listenTo(this.model,'change',this.toggleClass);this.model.trigger('change');},toggleVisibility:function(){this.model.toggleVisibility();},toggleClass:function(){this.$el.toggleClass('is-opened',this.model.get('isVisible'));},});(function(){var Layout=Backbone.Model.extend({defaults:{isBoxed:false,},initialize:function(){this.listenTo(this,'change',this.bodyClass);this.set('isBoxed','true'===localStorage.getItem(ptssVars.siteId+'_isBoxed'));},switchLayout:function(){this.set('isBoxed',!this.get('isBoxed'));localStorage.setItem(ptssVars.siteId+'_isBoxed',this.get('isBoxed'));ptssBuildPress.events.trigger('toggleLayoutStyle',this.get('isBoxed'));},bodyClass:function(){$('body').toggleClass('boxed',this.get('isBoxed'));},});ptssBuildPress.PageLayout=new Layout();})();ptssBuildPress.NavPosition=Backbone.Model.extend({defaults:{isSticky:false,},initialize:function(){this.listenTo(this,'change',this.updateNavPosition);this.set('isSticky','true'===localStorage.getItem(ptssVars.siteId+'_isSticky'));},toggleNavPosition:function(){this.set('isSticky',!this.get('isSticky'));localStorage.setItem(ptssVars.siteId+'_isSticky',this.get('isSticky'));},updateNavPosition:function(){$('body').toggleClass('fixed-navigation',this.get('isSticky'));$('body').trigger('update_sticky_state.pt');},});ptssBuildPress.ColorSkin=Backbone.Model.extend({defaults:{isSelected:false,color:'',css:{},},initialize:function(){this.listenTo(this,'change:isSelected',this.applySkin);},applySkin:function(){if(this.get('isSelected')){ptssBuildPress.events.trigger('updateCSS');localStorage.setItem(ptssVars.siteId+'_colorSkin',this.get('color'));}},});ptssBuildPress.colorPaletteCollection=Backbone.Collection.extend({model:ptssBuildPress.ColorSkin,initialize:function(){setTimeout(_.bind(this.setDefaultSkin,this),20);},setDefaultSkin:function(){var current=localStorage.getItem(ptssVars.siteId+'_colorSkin');if(null===current){this.first().set('isSelected',true);}
else{this.find(function(colorSkin){return current===colorSkin.get('color');}).set('isSelected',true);}}});ptssBuildPress.colorPalette=new ptssBuildPress.colorPaletteCollection([{color:'yellow',css:{main:'#f7c51e',darker:'#e8b60f'},},{color:'orange',css:{main:'#ff8b26',darker:'#ff7905'},},{color:'blue',css:{main:'#6da5f2',darker:'#4d91ef'},},{color:'green',css:{main:'#6fcc20',darker:'#60b01c'},},]);ptssBuildPress.BgImage=Backbone.Model.extend({defaults:{isSelected:false,repeatable:false,name:'',src:{},},initialize:function(){this.listenTo(this,'change:isSelected',this.updateBgImage);},updateBgImage:function(){if(this.get('isSelected')){ptssBuildPress.events.trigger('updateBgImage');localStorage.setItem(ptssVars.siteId+'_bgImage',this.get('name'));}},});ptssBuildPress.bgImgsCollection=Backbone.Collection.extend({model:ptssBuildPress.BgImage,initialize:function(){setTimeout(_.bind(this.setDefaultBg,this),20);},setDefaultBg:function(){var current=localStorage.getItem(ptssVars.siteId+'_bgImage');if(null===current){this.first().set('isSelected',true);}
else{this.find(function(bgImg){return current===bgImg.get('name');}).set('isSelected',true);}}});ptssBuildPress.bgImgs=new ptssBuildPress.bgImgsCollection([{name:'pattern1',repeatable:true,src:'1.png',sprite:1,},{name:'pattern2',repeatable:true,src:'2.png',sprite:2,},{name:'pattern3',repeatable:true,src:'3.png',sprite:3,},{name:'pattern4',repeatable:true,src:'4.png',sprite:4,},{name:'pattern5',repeatable:true,src:'5.png',sprite:5,},{name:'pattern6',repeatable:true,src:'6.png',sprite:6,},{name:'pattern7',repeatable:true,src:'7.png',sprite:7,},{name:'pattern8',repeatable:true,src:'8.png',sprite:8,},{name:'img9',repeatable:false,src:'9.jpg',sprite:9,},{name:'img10',repeatable:false,src:'10.jpg',sprite:10,},{name:'img11',repeatable:false,src:'11.jpg',sprite:11,},{name:'img12',repeatable:false,src:'12.jpg',sprite:12,},{name:'img13',repeatable:false,src:'13.jpg',sprite:13,},{name:'img14',repeatable:false,src:'14.jpg',sprite:14,},{name:'img15',repeatable:false,src:'15.jpg',sprite:15,},{name:'img16',repeatable:false,src:'16.jpg',sprite:16,},]);ptssBuildPress.pageLayoutView=Backbone.View.extend({events:{'click .ptss__layout-box--wide':'changeToWide','click .ptss__layout-box--boxed':'changeToBoxed',},template:_.template($('#ptss-layout-tmpl').html()),initialize:function(){this.listenTo(this.model,'change',this.render);this.render();return this;},render:function(){this.$('.ptss__setting-control').html(this.template(this.model.attributes));return this;},changeToWide:function(ev){if(this.model.get('isBoxed')){this.model.switchLayout();}
return this;},changeToBoxed:function(ev){if(!this.model.get('isBoxed')){this.model.switchLayout();}
return this;},});ptssBuildPress.navPositionView=Backbone.View.extend({events:{'click .ptss__setting-control':'changeNavPosition',},template:_.template($('#ptss-nav-tmpl').html()),initialize:function(){this.listenTo(this.model,'change',this.render);3
this.render();return this;},render:function(){this.$('.ptss__setting-control').html(this.template(this.model.attributes));return this;},changeNavPosition:function(){this.model.toggleNavPosition();return this;},});ptssBuildPress.colorSkinView=Backbone.View.extend({events:{'click':'changeToThisSkin',},template:'<i class="fa fa-check"></i>',tagName:'span',className:'ptss__color-option',initialize:function(){this.listenTo(this.model,'change:isSelected',this.updateSelected);this.model.trigger('change:isSelected');return this;},render:function(){this.$el.html(this.template);this.$el.css('background-color',this.model.attributes.css.main);return this;},changeToThisSkin:function(){ptssBuildPress.colorPalette.each(function(colorSkin){colorSkin.set('isSelected',false);});this.model.set('isSelected',true);return this;},updateSelected:function(){this.$el.toggleClass('is-selected',this.model.get('isSelected'));return this;},});ptssBuildPress.colorPaletteView=Backbone.View.extend({initialize:function(){ptssBuildPress.colorPalette.each(this.addColorSkin,this);return this;},addColorSkin:function(colorSkin){var skinView=new ptssBuildPress.colorSkinView({model:colorSkin,});this.$el.append(skinView.render().el);},});ptssBuildPress.bgImgView=Backbone.View.extend({events:{'click':'changeToThisBgImg',},template:'<i class="fa fa-check"></i>',tagName:'span',className:'ptss__bgimg-option',initialize:function(){this.listenTo(this.model,'change:isSelected',this.updateSelected);this.model.trigger('change:isSelected');return this;},render:function(){this.$el.html(this.template);this.$el.css('background-position','-'+((this.model.get('sprite')- 1)*30)+'px 0');return this;},changeToThisBgImg:function(){ptssBuildPress.bgImgs.each(function(bgImg){bgImg.set('isSelected',false);});this.model.set('isSelected',true);return this;},updateSelected:function(){this.$el.toggleClass('is-selected',this.model.get('isSelected'));return this;},});ptssBuildPress.bgImgsView=Backbone.View.extend({initialize:function(){this.listenTo(ptssBuildPress.events,'toggleLayoutStyle',this.toggleVisibility);ptssBuildPress.bgImgs.each(this.addBgImgs,this);this.toggleVisibility(ptssBuildPress.PageLayout.get('isBoxed'));return this;},addBgImgs:function(bgImg){var bgImgView=new ptssBuildPress.bgImgView({model:bgImg,});this.$('#ptss__boxed-backgrounds').append(bgImgView.render().el);},toggleVisibility:function(isBoxed){this.$el.toggle(isBoxed);},});ptssBuildPress.cssView=Backbone.View.extend({template:_.template($('#ptss-css-selectors-tmpl').html()),initialize:function(){this.listenTo(ptssBuildPress.events,'updateCSS updateBgImage',this.render);return this;},render:function(){var selectedColorSkin=ptssBuildPress.colorPalette.find(function(colorSkin){return colorSkin.get('isSelected');});var selectedBg=ptssBuildPress.bgImgs.find(function(bgImg){return bgImg.get('isSelected');});if(!_.every([selectedColorSkin,selectedBg])){return;}
this.$el.text(this.template({skin:selectedColorSkin.attributes,bg:selectedBg.attributes,pathToPlugin:ptssVars.pathToPlugin,}));return this;},});})();